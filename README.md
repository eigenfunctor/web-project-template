# Web Project Template

## Introduction

This repository is a template for containerized client/server applications written in typescript. This README will walk you through each component of the template so you may customize your application accordingly.

The template scaffolds the necessary client and server components required for user authentication, registration, and email verifications. Users may also have their administrator status modified.

You may check your developer environment against this [demo](https://web-project-template.eigenfunctor.io).

## Client
The client is a `nextjs` typescript application generated by `create-next-app`. The code is under the `client` folder.

- Pages are composed of components from the [MaterialUI React library](https://material-ui.com/).
  - [The MaterialUI](https://material-ui.com/customization/default-theme/) theme is under `client/components/theme-provider.ts`.
- [Array notation](https://material-ui.com/system/basics/#array) for [responsive styles](https://styled-system.com/responsive-styles) is used to configure the `Box` component throughout the pages.
- [@emotion/styled](https://emotion.sh/docs/styled) is the recommended library for customizing the CSS of containers.
- [@apollo/react-hooks](https://www.apollographql.com/docs/react/api/react-hooks) is used to query and mutate over the server's Graphql API.
- Routing is implicit by the folder structure under `client/pages`.
  - Internal links use the `Link` component under the `next/link` package for client-side routing.
  - External links use normal `<a>...</a>` tags.
- React hooks are used to manage state and effects elegantly.
  - `client/hooks/index.ts` exports all the application-specific hooks:
    - `client/hooks/auth-check` can be used to redirect the user from a page based on their login status.
    - `client/hooks/admin-check` can be used to redirect the user from a page based on their administrator status.
- `client/public` holds static content specific to the web application's look.

## Server
The server is a typescript microservice generated by [typeorm](https://typeorm.io/#/using-cli/initialize-a-new-typeorm-project). The code is under the `server` folder.

Once the server is up, you may immediately work with the graphql playground under the `/graphql` route.

You can set the `ADMIN_OVERRIDE_CODE` environment variable to a string like `ADMIN_OVERRIDE_CODE=mycode` and add the `override` query parameter to administrator page URLs to bootstrap the first administrator account into the database. DO NOT SET THIS ENVIRONMENT VARIABLE IN AN EXPOSED PRODUCTION DEPLOYMENT.
```
example:
http://localhost:3000/admin/users?override=mycode
```

- [express](https://expressjs.com/) is used to run the webserver hosting the GraphQL API and the authorization REST API.
- [apollo-server](https://www.apollographql.com/docs/apollo-server/) is used to define the GraphQL schema and run the server.
- [apollo-server-express](https://www.apollographql.com/docs/apollo-server/integrations/middleware/) is used to run the webserver hosting the GraphQL API and the authorization REST API.
- [passport](http://www.passportjs.org/) greatly simplifies authentication logic. The `/auth` route prefixes all authentication provider routes.
  - [Authentication providers](http://www.passportjs.org/packages/) may be added similar to how `server/src/routers/provider/local.ts` is used for local authentication.
  - `server/src/entity/local-user.ts` models locally registered users.
  - `server/src/entity/api-user.ts` models users authenticated by arbitrary authentication providers.

## Docker Compose
All microservices mentioned in the previous section are wired together using a docker-compose configuration.

You should edit the `docker-compose.yml` and edit image names and tags. Run `docker-compose build` to build production containers.

### Development
- `dev.yml` holds the development configuration.
 - Use `docker-compose -f dev.yml up` to start the development environment.
 - [Traefik](https://traefik.io/) will route requests to the correct service from `http://localhost:3000`.
 - [The SMTP container](https://hub.docker.com/r/namshi/smtp) runs as the SMTP service for outgoing emails.
 - [The Postgres container](https://hub.docker.com/_/postgres) hosts a development database under the pg-dev service.
- `docker-compose.yml` only holds the image names and tags for the production docker images.
- Production configurations depend on the deployment environment, and so there is no default configuration.

